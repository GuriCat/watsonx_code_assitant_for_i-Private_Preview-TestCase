# RPGB2.RPG プログラム仕様書

## 1. プログラム概要

### プログラム名
RPGB2

### プログラムの目的
商品（SYOHIN）ファイルのレコードを更新し、消費税率、最終更新日、最終更新時刻を設定するプログラム。

### 処理概要
指定された商品レコードに対して、消費税率8%を設定し、最終更新日時を記録してファイルを更新する。

## 2. ファイル定義

### 使用ファイル

| ファイル名 | 処理モード | レコード形式 | 説明 |
|----------|---------|------------|------|
| SYOHIN | UP（更新） | 外部記述（E） | 商品マスタファイル |

## 3. データ項目定義

### フィールド一覧

| フィールド名 | データ型 | 説明 |
|-----------|---------|------|
| PRTXR | 数値 | 消費税率（0.08 = 8%） |
| PRUPDT | 日付 | 最終更新日（*DATE形式） |
| PRUPTM | 時刻 | 最終更新時刻（TIME形式） |

## 4. 処理仕様

### 4.1 制御仕様（H仕様）

```rpg
H            Y                                     1
```

- デフォルトの制御オプションを使用
- 1次元配列のサポートを有効化（Y指定）

### 4.2 ファイル仕様（F仕様）

```rpg
FSYOHIN  UP  E                    DISK
```

- **SYOHIN**: 商品マスタファイル
- **UP**: 更新モード（Update）
- **E**: 外部記述ファイル
- **DISK**: ディスク装置

### 4.3 入力仕様（I仕様）

```rpg
ISYOHINR     10
```

- **SYOHINR**: 商品レコード形式
- **10**: レコード識別標識（標識10をオンに設定）

### 4.4 計算仕様（C仕様）

#### 処理フロー

1. **消費税率の設定**
```rpg
C                     Z-ADD0.08      PRTXR            消費税率
```
   - 定数0.08（8%）をPRTXRフィールドにゼロ加算（Z-ADD）で設定

2. **最終更新日の設定**
```rpg
C                     MOVE *DATE     PRUPDT           最終更新日
```
   - システム日付（*DATE）をPRUPDTフィールドに移動

3. **最終更新時刻の設定**
```rpg
C                     TIME           PRUPTM           最終更新時刻
```
   - 現在時刻をPRUPTMフィールドに取得

4. **レコード更新**
```rpg
C   10                UPDATSYOHINR
```
   - 標識10がオンの場合、SYOHINRレコード形式を使用してファイルを更新

## 5. 処理ロジック詳細

### 処理順序

```
開始
  ↓
消費税率 = 0.08（8%）を設定
  ↓
最終更新日 = 現在の日付を取得
  ↓
最終更新時刻 = 現在の時刻を取得
  ↓
標識10がオンの場合
  ↓
SYOHINレコードを更新
  ↓
終了
```

## 6. 条件処理

| 条件 | 処理 |
|-----|------|
| 標識10 = ON | SYOHINRレコードを更新（UPDAT操作） |
| 標識10 = OFF | 更新処理をスキップ |

## 7. エラー処理

- 本プログラムには明示的なエラー処理コードは含まれていません
- ファイル操作エラーはRPGランタイムのデフォルト処理に依存

## 8. 注意事項

1. **消費税率**: 8%（0.08）が固定値として設定されています。税率変更時はプログラムの修正が必要です。
2. **更新条件**: 標識10がオンの場合のみレコードが更新されます。
3. **レコードロック**: UPモードを使用しているため、レコードの読み込みと更新の間でロックが保持されます。
4. **日時形式**: 
   - 日付は*DATE（システム日付）形式
   - 時刻はTIME命令による取得

## 9. 前提条件

- SYOHINファイルが存在し、外部記述されていること
- SYOHINRレコード形式にPRTXR、PRUPDT、PRUPTMフィールドが定義されていること
- 適切なファイルアクセス権限があること

## 10. 保守履歴

| 日付 | 版数 | 変更内容 | 担当者 |
|-----|------|---------|--------|
| - | 1.0 | 初版作成 | - |

---

## 補足情報

### RPG固定形式仕様の説明

本プログラムは伝統的なRPG固定形式（Column-based）で記述されています：

- **Hスペック（1-5桁目）**: プログラム制御情報
- **Fスペック（7-42桁目）**: ファイル定義
- **Iスペック（7-42桁目）**: 入力レコード定義
- **Cスペック（7-74桁目）**: 計算処理とロジック

### 操作コード

- **Z-ADD**: ゼロ加算（実質的には代入）
- **MOVE**: 右寄せでデータを移動
- **TIME**: システム時刻を取得
- **UPDAT**: レコードを更新
